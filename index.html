<!DOCTYPE html>
<html>
<head>
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="login-reg.css">
	<script src="jquery-3.2.0.min.js"></script>
</head>
<body>
	<form action="login.php" method="post" id="reg">
		<div id="reg-form">
			<div id="header">Mini<span>Chat</span></div>
			<div id="inputs">
				<input class="area" type="text" name="username" id="username" placeholder="username" />
				<input class="area" type="password" name="pass" id="pass" placeholder="password" />
				<input type="submit" style="margin-right:1rem" value="Войти" />
			</div>
			<div id='links'>
				<a class="link" href="registration.html">Регистрация</a>
				<a class="link" href="#">Забыли пароль?</a>
			</div>
			<div id="error"></div>
			<div id="footer">&copy; Copyright Abdulmajid Aynizoda 2020</div>
		</div>
	</form>
	<script>
		reg.addEventListener('submit', function(e) {
			if(pass.value == '' || username.value == '') {
				error.innerHTML = 'Не введен логин или пароль!'
				error.style.display = 'block';
				e.preventDefault()
			} else {
				e.preventDefault()
				error.style.display = 'block'
				error.style.color = '#fff'
				error.innerHTML = 'Загрузка...'
				let query = $.ajax({
					type: 'POST',
					url: 'login.php',
					data: `username=${username.value}&pass=${pass.value}`,
					dataType: 'html',
					success: function(data) {
						if(data.length > 31) {
							error.innerHTML = 'Пользователь найден, ждите 3 сек.'
							reg.submit()
						} else {
							if(error.style.display == 'none') {
								error.style.display = 'block'
							}
							error.style.color = 'red'
							error.innerHTML = data
						}
					}
				})
			}
		})
	</script>
</body>
</html>